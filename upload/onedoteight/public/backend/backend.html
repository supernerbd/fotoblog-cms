<!DOCTYPE html>
<html lang="en">
<head>
      <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.4.2.min.js"></script>
	  <script>
	  "use strict";
	  //check if user is logged in. Else send him to login asap.
	  Parse.initialize("j98M3FFiX4SE5AMkVMemB3Hx3MRMsYsoOOVPU9E4", "ClttYScbdV99VRVQKc3GgaD41KG95Iiq0TEUabGn");
			
		var currentUser = Parse.User.current();
		if(!currentUser) {
			window.location.href = "./index.html";
		}
	  </script>
      <title>Upload Pics</title>
      <meta charset="UTF-8">
	  <meta name="robots" content="noindex" />
      <link rel="stylesheet" type="text/css" href="nice.css">
      <script src="js/load-image.js"></script>
	  <script src="js/load-image-meta.js"></script>
	  <script src="js/load-image-exif.js"></script>
	  <script src="js/load-image-exif-map.js"></script>
      <script>
	  (function(){
		function init(){//init all modules
			//init parse uploading code
			
			//init preview and exif code
			
			//hook up event listeners
			//Reset
			document.querySelector("#reset").onclick = function (e) {
				document.location.reload(true);
			}
			//Select
			document.querySelector("#imageFile").onchange = function (e) {
				var loadingImage = loadImage( //load image on screen
					e.target.files[0],
					function (img) {
						document.querySelector("#workframe").appendChild(img);
						document.querySelector("#imageFile").disabled = true;
					},
					{maxHeight: 800}
				);
				if (!loadingImage) {
					// Alternative code ...
				}
				loadImage.parseMetaData( //load exif data in form
					e.target.files[0],
					function (data) {
						if(!data.exif){
							//handle error!
							document.querySelector(".error").innerHTML = "Error while reading exif data: file contains no exif!";
						}
						else{
							console.log(data.exif.getAll());
							var exif = data.exif.getAll();
							document.querySelector("#photographer").value=currentUser.getUsername();
							document.querySelector("#FNumber").value = exif.FNumber;
							if(exif.ExposureTime<1){
								document.querySelector("#ExposureTime").value = "1/" + 1/exif.ExposureTime;
							}
							else{
								document.querySelector("#ExposureTime").value = exif.ExposureTime;
							}
							document.querySelector("#FocalLength").value = exif.FocalLength;
							document.querySelector("#PhotographicSensitivity").value = exif.PhotographicSensitivity;
							document.querySelector("#Make").value = exif.Make;
							document.querySelector("#Model").value = exif.Model;
						}
				});
			}
		};
      
        window.onload = init;
	   }());
      </script>
</head>
<body>
	<h1>Upload the pictures!</h1>
	<div id="workframe">
		<!--<div id="pic">
		
		</div>-->
		<form class="main" id="signupForm" action="#" method="POST">
            <div class="entry">
                <label for="photographer">Photographer: </label>
                <input id="photographer" name="photographer" type="text">
            </div>
			<div class="entry">
                <label for="location">Location: </label>
                <input id="location" name="location" type="text">
            </div>
            <div class="entry">
                <label for="FNumber">F Number: </label>
                <input id="FNumber" name="FNumber" type="text">
            </div>
            <div class="entry">
                <label for="ExposureTime">Exposure Time: </label>
                <input id="ExposureTime" name="ExposureTime" type="text">
            </div>
			<div class="entry">
                <label for="FocalLength">Focal Length: </label>
                <input id="FocalLength" name="FocalLength" type="text">
            </div>
			<div class="entry">
                <label for="PhotographicSensitivity">ISO: </label>
                <input id="PhotographicSensitivity" name="PhotographicSensitivity" type="text">
            </div>
			<div class="entry">
                <label for="Make">Make: </label>
                <input id="Make" name="Make" type="text">
            </div>
			<div class="entry">
                <label for="Model">Model: </label>
                <input id="Model" name="Model" type="text">
            </div>
            <p class="error"></p>
        </form>
	</div>
	<input id="reset" type="reset" value="Reset">
	<input value="Select a pic" type="file" class="imageFile" id="imageFile" accept="image/*">
	<input id="upload" type="submit" value="Upload">
</body>
</html>